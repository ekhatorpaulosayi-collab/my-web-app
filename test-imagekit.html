<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ImageKit Integration Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
      background: #f9fafb;
    }
    h1 {
      color: #1e293b;
      border-bottom: 3px solid #667eea;
      padding-bottom: 16px;
      margin-bottom: 32px;
    }
    .test-section {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h2 {
      color: #334155;
      font-size: 18px;
      margin-top: 0;
      margin-bottom: 16px;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      margin-left: 12px;
    }
    .status.success { background: #d1fae5; color: #065f46; }
    .status.error { background: #fee2e2; color: #991b1b; }
    .status.pending { background: #fef3c7; color: #92400e; }
    .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 16px;
    }
    .image-card {
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      background: #fafafa;
    }
    .image-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 12px;
    }
    .image-card .label {
      font-size: 13px;
      font-weight: 600;
      color: #64748b;
      margin-bottom: 4px;
    }
    .image-card .url {
      font-size: 11px;
      color: #94a3b8;
      word-break: break-all;
      font-family: 'Courier New', monospace;
      background: white;
      padding: 8px;
      border-radius: 4px;
      max-height: 60px;
      overflow-y: auto;
    }
    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    .metric {
      background: #f8fafc;
      padding: 16px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    .metric-label {
      font-size: 12px;
      color: #64748b;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .metric-value {
      font-size: 24px;
      font-weight: 700;
      color: #1e293b;
    }
    code {
      background: #f1f5f9;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 13px;
      color: #475569;
    }
    .instructions {
      background: #eff6ff;
      border-left: 4px solid #3b82f6;
      padding: 16px;
      border-radius: 4px;
      margin: 20px 0;
    }
    .instructions h3 {
      margin-top: 0;
      color: #1e40af;
      font-size: 16px;
    }
    .instructions ol {
      margin: 8px 0;
      padding-left: 20px;
    }
    .instructions li {
      margin: 8px 0;
      color: #1e3a8a;
    }
  </style>
</head>
<body>
  <h1>üñºÔ∏è ImageKit Integration Test</h1>

  <div class="instructions">
    <h3>üìã Before Testing:</h3>
    <ol>
      <li>Login to <a href="https://imagekit.io/dashboard" target="_blank">ImageKit Dashboard</a></li>
      <li>Go to <strong>External Storage</strong> ‚Üí <strong>Add origin</strong></li>
      <li>Set Base URL: <code>https://yzlniqwzqlsftxrtapdl.supabase.co/storage/v1/object/public</code></li>
      <li>Save and wait 30 seconds for propagation</li>
      <li>Then reload this page!</li>
    </ol>
  </div>

  <div class="test-section">
    <h2>
      ‚úÖ Configuration Check
      <span class="status success">READY</span>
    </h2>
    <div class="metrics">
      <div class="metric">
        <div class="metric-label">ImageKit Endpoint</div>
        <div class="metric-value" style="font-size: 14px;">ik.imagekit.io/onelove431212341234</div>
      </div>
      <div class="metric">
        <div class="metric-label">Supabase Project</div>
        <div class="metric-value" style="font-size: 14px;">yzlniqwzqlsftxrtapdl</div>
      </div>
      <div class="metric">
        <div class="metric-label">Status</div>
        <div class="metric-value" style="font-size: 18px; color: #059669;">Connected ‚úì</div>
      </div>
    </div>
  </div>

  <div class="test-section">
    <h2>
      üß™ ImageKit Transformation Test
      <span id="test-status" class="status pending">Loading...</span>
    </h2>
    <p style="color: #64748b; font-size: 14px;">
      Testing if ImageKit can fetch and transform images from your Supabase Storage.
      We're using a sample path - replace with your actual product image path once uploaded.
    </p>

    <div class="image-grid" id="image-grid">
      <!-- Images will be loaded here by JavaScript -->
    </div>

    <div class="metrics" style="margin-top: 24px;">
      <div class="metric">
        <div class="metric-label">Images Loaded</div>
        <div class="metric-value" id="loaded-count">0</div>
      </div>
      <div class="metric">
        <div class="metric-label">Failed</div>
        <div class="metric-value" id="failed-count" style="color: #dc2626;">0</div>
      </div>
      <div class="metric">
        <div class="metric-label">Avg Load Time</div>
        <div class="metric-value" id="avg-time">-- ms</div>
      </div>
    </div>
  </div>

  <div class="test-section">
    <h2>üìù Next Steps After Testing</h2>
    <ol style="color: #475569; line-height: 1.8;">
      <li>If images load successfully above: <strong style="color: #059669;">You're all set! üéâ</strong></li>
      <li>Upload product images in your app</li>
      <li>Visit your storefront to see optimized images</li>
      <li>Check Network tab - images should be from <code>ik.imagekit.io</code></li>
      <li>Images should be WebP format (85% smaller!)</li>
    </ol>
  </div>

  <script>
    const IMAGEKIT_ENDPOINT = 'https://ik.imagekit.io/onelove431212341234';

    // Sample test paths - you can replace these with actual product image paths
    const TEST_IMAGES = [
      // Test with Storehouse logo (public asset)
      'storehouse-logo-blue.png',
      'storehouse-icon.png',
    ];

    const imageGrid = document.getElementById('image-grid');
    const testStatus = document.getElementById('test-status');
    const loadedCount = document.getElementById('loaded-count');
    const failedCount = document.getElementById('failed-count');
    const avgTime = document.getElementById('avg-time');

    let loaded = 0;
    let failed = 0;
    let loadTimes = [];

    function getImageKitUrl(path, options = {}) {
      const { width, height, quality = 85, format = 'auto' } = options;
      const transformations = [];

      if (width) transformations.push(`w-${width}`);
      if (height) transformations.push(`h-${height}`);
      if (quality) transformations.push(`q-${quality}`);
      if (format) transformations.push(`f-${format}`);

      const transformString = transformations.length > 0 ? `/tr:${transformations.join(',')}` : '';

      return `${IMAGEKIT_ENDPOINT}${transformString}/${path}`;
    }

    function createImageCard(label, url) {
      const card = document.createElement('div');
      card.className = 'image-card';

      const img = document.createElement('img');
      const startTime = Date.now();

      img.onload = () => {
        loaded++;
        loadedCount.textContent = loaded;
        const loadTime = Date.now() - startTime;
        loadTimes.push(loadTime);
        avgTime.textContent = Math.round(loadTimes.reduce((a, b) => a + b, 0) / loadTimes.length) + ' ms';
        updateStatus();
      };

      img.onerror = () => {
        failed++;
        failedCount.textContent = failed;
        card.style.borderColor = '#ef4444';
        updateStatus();
      };

      img.src = url;
      img.alt = label;

      card.innerHTML = `
        <div class="label">${label}</div>
      `;
      card.appendChild(img);
      card.innerHTML += `<div class="url">${url}</div>`;

      return card;
    }

    function updateStatus() {
      if (failed > 0 && loaded === 0) {
        testStatus.className = 'status error';
        testStatus.textContent = 'Origin Not Configured';
      } else if (loaded > 0) {
        testStatus.className = 'status success';
        testStatus.textContent = `Working! (${loaded} loaded)`;
      }
    }

    // Create test images
    TEST_IMAGES.forEach(path => {
      imageGrid.appendChild(createImageCard('Original', getImageKitUrl(path)));
      imageGrid.appendChild(createImageCard('Optimized (300px)', getImageKitUrl(path, { width: 300, quality: 85 })));
      imageGrid.appendChild(createImageCard('WebP (200px)', getImageKitUrl(path, { width: 200, format: 'webp' })));
    });

    // Add a note about custom images
    const note = document.createElement('div');
    note.style.cssText = 'grid-column: 1 / -1; background: #fef3c7; padding: 16px; border-radius: 8px; border-left: 4px solid #f59e0b; margin-top: 8px;';
    note.innerHTML = `
      <strong style="color: #92400e;">üìù Note:</strong>
      <span style="color: #78350f;">These are test images from your public folder. Once you upload product images through your app, they will automatically be optimized by ImageKit!</span>
    `;
    imageGrid.appendChild(note);
  </script>
</body>
</html>
